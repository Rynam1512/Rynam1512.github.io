
<!-- Remarque importante : l'utilisation de `var` dans ce contexte √©tait impossible, car le code ne fonctionnait pas correctement tant que -->
<!--   mais l'utilisationd e const √©atit bcp plsu adapt√©e-->

<html lang="fr"> <!-- D√©b. doc HTML, langue = fr (FR) -->
<head> <!-- T√™te du doc : m√©tadonn√©es + liens ext. -->
  <meta charset="UTF-8" /> <!-- Encodage UTF-8 pr g√©rer caract√®res sp√©ciaux -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <!-- Adaptation mobile (resp.) -->
  <title>Quiz m√©dical</title> <!-- Titre affich√© ds onglet navigateur -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet"> <!-- CDN de Tailwind CSS pr styliser -->
</head>

<body class="bg-gray-100"> <!-- D√©b. corps du doc avec fond gris clair -->

    <main class="max-w-4xl mx-auto px-4 py-8"> <!-- Contenu principal : largeur max, centr√©, paddings -->

        <div id="quizIntro" class="bg-white rounded-xl shadow-lg p-8 mb-8 fade-in">
            <!-- Intro quiz : fond blanc, coins arrondis, ombre, marges, effet fade-in -->
            
            <h2 class="text-2xl font-bold text-center text-indigo-800 mb-6">
              Quiz m√©dical interactif
            </h2> <!-- Titre principal, gras, centr√©, couleur indigo -->

            <p class="text-gray-700 mb-6">
              Testez vos connaissances m√©dicales avec notre quiz interactif. Choisissez un th√®me ci-dessous pour commencer !
            </p> <!-- Intro descriptive -->

            <!-- Grille responsive pr les 4 cartes th√©matiques -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8"> 
                
                <!-- CARTE 1 : Maladies infectieuses -->
                <div id="theme-diseases" class="theme-card bg-blue-50 p-6 rounded-lg border border-blue-200 cursor-pointer">
                    <div class="flex items-center mb-3">
                        <span class="text-3xl mr-3">ü¶†</span> <!-- Emoji virus -->
                        <h3 class="font-semibold text-xl text-blue-800">Maladies Infectieuses</h3>
                    </div>
                    <p class="text-gray-600 mb-3">
                      D√©couvrez comment se transmettent les principales maladies.
                    </p>
                    <p class="text-sm text-blue-600">4 questions ‚Ä¢ 8 points</p>
                </div>

                <!-- CARTE 2 : G√©n√©tique -->
                <div id="theme-genetics" class="theme-card bg-purple-50 p-6 rounded-lg border border-purple-200 cursor-pointer">
                    <div class="flex items-center mb-3">
                        <span class="text-3xl mr-3">üß¨</span> <!-- Emoji ADN -->
                        <h3 class="font-semibold text-xl text-purple-800">G√©n√©tique & Corps Humain</h3>
                    </div>
                    <p class="text-gray-600 mb-3">
                      Testez vos connaissances sur la constitution du corps humain.
                    </p>
                    <p class="text-sm text-purple-600">9 questions ‚Ä¢ 18 points</p>
                </div>

                <!-- CARTE 3 : Informatique & Bioinfo -->
                <div id="theme-informatics" class="theme-card bg-green-50 p-6 rounded-lg border border-green-200 cursor-pointer">
                    <div class="flex items-center mb-3">
                        <span class="text-3xl mr-3">üë®‚Äçüíª</span> <!-- Emoji dev -->
                        <h3 class="font-semibold text-xl text-green-800">Informatique & Bioinformatique</h3>
                    </div>
                    <p class="text-gray-600 mb-3">
                      Explorez les applications de l'informatique en m√©decine.
                    </p>
                    <p class="text-sm text-green-600">4 questions ‚Ä¢ 8 points</p>
                </div>

                <!-- CARTE 4 : Quiz Complet -->
                <div id="theme-all" class="theme-card bg-gradient-to-r from-indigo-50 to-pink-50 p-6 rounded-lg border border-indigo-200 cursor-pointer">
                    <div class="flex items-center mb-3">
                        <span class="text-3xl mr-3">üîç</span> <!-- Emoji loupe -->
                        <h3 class="font-semibold text-xl text-indigo-800">Quiz Complet</h3>
                    </div>
                    <p class="text-gray-600 mb-3">
                      Relevez le d√©fi avec toutes les questions m√©lang√©es !
                    </p>
                    <p class="text-sm text-indigo-600">17 questions ‚Ä¢ 34 points</p>
                </div>

            </div> <!-- fin div .grid des cartes -->

            <div class="text-center text-gray-600 text-sm">
                <p>Cliquez sur un th√®me pour commencer le quiz</p>
            </div> <!-- message d'instruction centr√© -->
            
        </div> <!-- fin intro quiz -->

<!--  Conteneur pr le quiz (cach√© par d√©faut) -->
<div id="quizContainer" class="hidden">

    <!--  En-t√™te : num q¬∞ + timer + barre progression -->
    <div class="mb-6">

        <!--  Ligne avec compteur de q¬∞ et timer -->
        <div class="flex justify-between items-center mb-2">
            <!--  Affiche n¬∞ q¬∞ actuelle / total -->
            <span id="questionCounter" class="text-sm font-medium text-gray-600">Question 1/9</span>
            <!-- Ô∏è Timer affich√© -->
            <span id="timer" class="text-sm font-medium text-gray-600">00:00</span>
        </div>

        <!--  Barre de prog g√©n√©rale -->
        <div class="progress-bar">
            <!--  Avanc√©e de la barre (pct √©volue dyn) -->
            <div id="progressBar" class="progress" style="width: 11%;"></div>
        </div>
    </div>

    <!--  Contenu de la q¬∞ (texte + btns + cat√©) -->
    <div id="questionContainer" class="bg-white rounded-xl shadow-lg p-8 mb-8 fade-in">

        <!-- Ô∏è Badge pr indiquer cat√© de la q¬∞ -->
        <div id="categoryBadge" class="inline-block px-3 py-1 rounded-full text-sm font-medium mb-4"></div>

        <!--  Texte de la q¬∞ pos√©e -->
        <h3 id="questionText" class="text-xl font-bold text-gray-800 mb-6"></h3>

        <!--  Choix/r√©p q¬∞ s‚Äôaffichent ici dyn -->
        <div id="options" class="space-y-3">
            <!--  R√©p dyn g√©n√©r√©es ici en JS -->
        </div>

        <!--  Btns nav : pr√©c√©dent + suivant -->
        <div class="mt-8 flex justify-between">

            <!-- ‚¨ÖÔ∏è Btn retour (invisible q¬∞1) -->
            <button id="prevBtn" class="px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors hidden">
                ‚Üê Pr√©c√©dent
            </button>

            <!--  Btn suivant (d√©sactiv√© si pas r√©p) -->
            <button id="nextBtn" class="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                Suivant ‚Üí
            </button>
        </div>
    </div>
</div>

 <!-- Results container -->
<div id="resultsContainer" class="hidden bg-white rounded-xl shadow-lg p-8 fade-in">

    <!-- Titre des r√©sultats -->
    <h2 class="text-2xl font-bold text-center text-indigo-800 mb-6">R√©sultats du quiz</h2>
    
    <!-- Zone centrale avec score -->
    <div class="text-center mb-8">

        <!-- Cercle contenant score -->
        <div id="scoreCircle" class="inline-flex items-center justify-center w-32 h-32 rounded-full border-4 border-indigo-500 mb-4">
            <div>
                <!-- Valeur du score -->
                <span id="scoreValue" class="block text-3xl font-bold text-indigo-700">0</span>
                <!-- Total de points -->
                <span id="scoreTotal" class="text-sm text-gray-600">sur 34</span>
            </div>
        </div>

        <!-- Message li√© au score -->
        <p id="scoreMessage" class="text-lg font-medium text-gray-700"></p>
    </div>
    
    <!-- Affichage du temps total -->
    <div id="timeResult" class="text-center mb-6 text-gray-600">
        Temps total: <span id="totalTime">00:00</span>
    </div>
    
    <!-- Section r√©sum√© par th√®me -->
    <div class="mb-6">
        <!-- Titre du r√©sum√© -->
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-semibold text-gray-800">R√©sum√© par th√®me</h3>
        </div>

        <!-- Cartes ou blocs par th√®me -->
        <div id="themeResults" class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <!-- R√©sultats th√©matiques g√©n√©r√©s dynamiquement -->
        </div>
    </div>
    
    <!-- Section revue des r√©ponses -->
    <div id="answersReview" class="space-y-6 mb-8">
        <!-- D√©tails des r√©ponses affich√©s ici dynamiquement -->
    </div>
</div>

            
            <div class="text-center space-x-4">
                <button id="restartQuizBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-8 rounded-full shadow-lg hover:shadow-xl transition-all transform hover:scale-105">
                    Recommencer le quiz
                </button>
                <button id="chooseThemeBtn" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-3 px-8 rounded-full shadow-lg hover:shadow-xl transition-all transform hover:scale-105">
                    Choisir un autre th√®me
                </button>
            </div>
        </div>
    </main>
</div>


<script>
    // LES QUIZZ : D√©finition de toutes les questions du quiz dans un tableau appel√© allQuizData
    const allQuizData = [
        // Sujet : Maladies Infectieuses
        {
            // Cat√©gorie du quiz (affich√©e avec une ic√¥ne)
            category: "ü¶† Maladies Infectieuses",
            // Th√®me technique utilis√© pour filtrer ou cat√©goriser les questions
            theme: "diseases",
            // Question pos√©e √† l'utilisateur
            question: "Comment se transmet principalement la tuberculose ?",
            // Choix de r√©ponses propos√©s
            options: [
                "Par contact avec la peau",
                "Par des gouttelettes respiratoires",
                "Par l'eau contamin√©e",
                "Par le sang",
                "Par les moustiques"
            ],
            // Index (0-based) de la bonne r√©ponse dans le tableau options
            correctAnswer: 1,
            // Explication affich√©e apr√®s la r√©ponse
            explanation: "La tuberculose se transmet par voie a√©rienne, via les microgouttelettes √©mises lorsqu'une personne infect√©e tousse ou √©ternue."
        },
        {
            category: "ü¶† Maladies Infectieuses",
            theme: "diseases",
            question: "Quel est le mode principal de transmission du VIH ?",
            options: [
                "Par les moustiques",
                "Par les gouttelettes respiratoires",
                "Par le lait maternel",
                "Par les rapports sexuels non prot√©g√©s",
                "Par contact cutan√©"
            ],
            correctAnswer: 3,
            explanation: "Le VIH se transmet par le sang, les s√©cr√©tions sexuelles et le lait maternel, principalement via les rapports sexuels non prot√©g√©s."
        },
        {
            category: "ü¶† Maladies Infectieuses",
            theme: "diseases",
            question: "Comment se transmet le paludisme ?",
            options: [
                "Par les rapports sexuels",
                "Par contact avec un animal contamin√©",
                "Par les moustiques infect√©s",
                "Par l'eau potable",
                "Par contact avec une plaie"
            ],
            correctAnswer: 2,
            explanation: "Le paludisme est transmis par la piq√ªre de moustiques anoph√®les infect√©s."
        },
        {
            category: "ü¶† Maladies Infectieuses",
            theme: "diseases",
            question: "Quelle est la voie de transmission principale du COVID-19 ?",
            options: [
                "Par l'eau du robinet",
                "Par des aliments",
                "Par des gouttelettes respiratoires",
                "Par le sang",
                "Par les moustiques"
            ],
            correctAnswer: 2,
            explanation: "Le COVID-19 se transmet principalement par voie respiratoire, via des gouttelettes et a√©rosols √©mis lorsqu'une personne parle, tousse ou √©ternue."
        },
        
        // Th√®me : G√©n√©tique & Corps Humain
        {
            category: "üß¨ G√©n√©tique & Corps Humain",
            theme: "genetics",
            question: "Combien de chromosomes contient une cellule humaine ?",
            options: [
                "23",
                "44",
                "46",
                "92",
                "22"
            ],
            correctAnswer: 2,
            explanation: "Une cellule humaine contient 46 chromosomes, dont 2 chromosomes sexuels (gonosomes)."
        },
        {
            category: "üß¨ G√©n√©tique & Corps Humain",
            theme: "genetics",
            question: "Quel est le r√¥le de la mitose ?",
            options: [
                "Cr√©er des cellules sexuelles",
                "R√©duire le nombre de chromosomes",
                "Produire deux cellules filles identiques",
                "M√©langer le mat√©riel g√©n√©tique",
                "Cr√©er la diversit√© g√©n√©tique"
            ],
            correctAnswer: 2,
            explanation: "La mitose permet de produire deux cellules filles identiques √† la cellule m√®re, pour la croissance ou le renouvellement cellulaire."
        },
        {
            category: "üß¨ G√©n√©tique & Corps Humain",
            theme: "genetics",
            question: "Quels sont les macronutriments essentiels pour l'organisme humain?",
            options: [
                "Vitamines, sels min√©raux et eau",
                "Prot√©ines, glucides et lipides",
                "Calcium, fer et magn√©sium",
                "ADN, ARN et enzymes",
                "Eau, fibres et cholest√©rol"
            ],
            correctAnswer: 1,
            explanation: "Les macronutriments sont les prot√©ines, glucides et lipides, indispensables au bon fonctionnement de l'organisme."
        },
        {
            category: "üß¨ G√©n√©tique & Corps Humain",
            theme: "genetics",
            question: "Quel est le r√¥le principal du c≈ìur ?",
            options: [
                "Filtrer le sang",
                "Produire les globules rouges",
                "Pomper et faire circuler le sang pour l'enrichir en O‚ÇÇ et l'appauvrir en CO‚ÇÇ",
                "R√©guler la digestion",
                "Produire l'adr√©naline"
            ],
            correctAnswer: 2,
            explanation: "Le c≈ìur est un muscle qui pompe le sang, permettant son passage dans les poumons pour les √©changes gazeux (apport d'oxyg√®ne et √©limination du dioxyde de carbone), puis sa distribution √† tous les organes."
        },
        {
            category: "üß¨ G√©n√©tique & Corps Humain",
            theme: "genetics",
            question: "Quelle partie du cerveau est responsable du raisonnement logique ?",
            options: [
                "Le cervelet",
                "Le tronc c√©r√©bral",
                "Le cortex pr√©frontal",
                "L'amygdale",
                "L'hippocampe"
            ],
            correctAnswer: 2,
            explanation: "Le cortex pr√©frontal est impliqu√© dans les fonctions cognitives sup√©rieures comme le raisonnement et la planification."
        },
        {
            category: "üß¨ G√©n√©tique & Corps Humain",
            theme: "genetics",
            question: "Quel est le r√¥le principal des poumons ?",
            options: [
                "Filtrer les toxines",
                "√âchanger les gaz respiratoires",
                "Produire du mucus",
                "Filtrer le sang",
                "√âquilibrer le pH sanguin"
            ],
            correctAnswer: 1,
            explanation: "Les poumons permettent les √©changes gazeux entre l'air et le sang (O2 et CO2)."
        },
        {
            category: "üß¨ G√©n√©tique & Corps Humain",
            theme: "genetics",
            question: "Quel est le plus grand os du corps humain ?",
            options: [
                "Hum√©rus",
                "Cr√¢ne",
                "F√©mur",
                "Tibia",
                "Colonne vert√©brale"
            ],
            correctAnswer: 2,
            explanation: "Le f√©mur est le plus long et le plus lourd des os du squelette humain."
        },
        {
            category: "üß¨ G√©n√©tique & Corps Humain",
            theme: "genetics",
            question: "Combien d'os composent le corps humain adulte ?",
            options: [
                "200",
                "206",
                "210",
                "300",
                "178"
            ],
            correctAnswer: 1,
            explanation: "Le squelette humain adulte est constitu√© de 206 os."
        },
        {
            category: "üß¨ G√©n√©tique & Corps Humain",
            theme: "genetics",
            question: "Quel organe est responsable de la d√©toxification du sang ?",
            options: [
                "Les reins",
                "Le foie",
                "La rate",
                "Le pancr√©as",
                "Les poumons"
            ],
            correctAnswer: 1,
            explanation: "Le foie est l'organe principal de d√©toxification du sang, filtrant les substances nocives et les transformant en compos√©s moins toxiques."
        },

        // Th√®me : Informatique & Bioinformatique
        {
            category: "üë®‚Äçüíª Informatique & Bioinformatique",
            theme: "informatics",
            question: "Quelle est la diff√©rence entre bioinformatique et informatique biom√©dicale ?",
            options: [
                "Aucune, c'est pareil",
                "L'une concerne les m√©dicaments, l'autre les virus",
                "L'informatique biom√©dicale traite les soins et la sant√© publique ; la bioinformatique √©tudie les donn√©es biologiques (ADN, prot√©ines, etc.)",
                "La bioinformatique est plus ancienne",
                "L'informatique biom√©dicale ne fait pas de recherche"
            ],
            correctAnswer: 2,
            explanation: "La bioinformatique est centr√©e sur les donn√©es mol√©culaires et g√©nomiques, tandis que l'informatique biom√©dicale inclut les syst√®mes de sant√©, dossiers m√©dicaux, et donn√©es de sant√© publique."
        },
        {
            category: "üë®‚Äçüíª Informatique & Bioinformatique",
            theme: "informatics",
            question: "Que permet la bioinformatique ?",
            options: [
                "Concevoir des robots chirurgicaux",
                "S√©quencer des g√©nomes et analyser des donn√©es biologiques complexes",
                "Diagnostiquer les maladies sans m√©decin",
                "Remplacer les m√©decins",
                "G√©rer les h√¥pitaux"
            ],
            correctAnswer: 1,
            explanation: "La bioinformatique permet de traiter, analyser et mod√©liser des donn√©es biologiques, notamment g√©n√©tiques et prot√©omiques."
        },
        {
            category: "üë®‚Äçüíª Informatique & Bioinformatique",
            theme: "informatics",
            question: "Quel outil informatique est couramment utilis√© pour g√©rer des donn√©es cliniques ?",
            options: [
                "Word",
                "Photoshop",
                "R ou Python",
                "SQL",
                "Excel uniquement"
            ],
            correctAnswer: 2, // <- √† noter : cet objet contient aussi une propri√©t√© multipleAnswers qui va suivre
            multipleAnswers: true, // Indique que cette question accepte plusieurs bonnes r√©ponses
            correctAnswers: [2, 3], // Liste des bonnes r√©ponses par index (ici : R ou Python et SQL)
            explanation: "Les langages comme R, Python et SQL sont couramment utilis√©s pour g√©rer et analyser des bases de donn√©es cliniques et biologiques."
        },
        {
            category: "üë®‚Äçüíª Informatique & Bioinformatique",
            theme: "informatics",
            question: "Quel logiciel est couramment utilis√© pour g√©rer les r√©f√©rences bibliographiques ?",
            options: [
                "Excel",
                "Zotero",
                "Word",
                "Python",
                "Firefox"
            ],
            correctAnswer: 1,

            explanation: "Zotero est un logiciel libre et gratuit qui permet de collecter, organiser, citer et partager des r√©f√©rences bibliographiques. Il s'int√®gre facilement aux navigateurs web et aux traitements de texte comme Word ou LibreOffice."
        }
    ];


// Initialisation des variables globales utilis√©es dans le quiz
let quizData = []; // Contient les questions du quiz selon le th√®me
let currentQuestion = 0; // Index de la question en cours
let score = 0; // Score de l'utilisateur
let userAnswers = []; // R√©ponses de l'utilisateur
let quizStartTime; // Heure de d√©but du quiz
let quizEndTime; // Heure de fin du quiz
let timerInterval; // Intervalle du minuteur
let currentTheme = ""; // Th√®me actuel choisi
let maxScore = 0; // Score maximal possible

// R√©cup√©ration des √©l√©ments HTML du DOM par leur ID
const quizIntro = document.getElementById('quizIntro');
const quizContainer = document.getElementById('quizContainer');
const resultsContainer = document.getElementById('resultsContainer');
const questionCounter = document.getElementById('questionCounter');
const progressBar = document.getElementById('progressBar');
const categoryBadge = document.getElementById('categoryBadge');
const questionText = document.getElementById('questionText');
const optionsContainer = document.getElementById('options');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const scoreValue = document.getElementById('scoreValue');
const scoreTotal = document.getElementById('scoreTotal');
const scoreMessage = document.getElementById('scoreMessage');
const totalTime = document.getElementById('totalTime');
const answersReview = document.getElementById('answersReview');
const restartQuizBtn = document.getElementById('restartQuizBtn');
const chooseThemeBtn = document.getElementById('chooseThemeBtn');
const timerDisplay = document.getElementById('timer');
const homeBtn = document.getElementById('homeBtn');
const themeResults = document.getElementById('themeResults');

// Boutons pour le choix des th√®mes
const themeDiseases = document.getElementById('theme-diseases');
const themeGenetics = document.getElementById('theme-genetics');
const themeInformatics = document.getElementById('theme-informatics');
const themeAll = document.getElementById('theme-all');

// √âv√©nements li√©s au choix des th√®mes
themeDiseases.addEventListener('click', () => startQuizByTheme('diseases'));
themeGenetics.addEventListener('click', () => startQuizByTheme('genetics'));
themeInformatics.addEventListener('click', () => startQuizByTheme('informatics'));
themeAll.addEventListener('click', () => startQuizByTheme('all'));

// √âv√©nements des boutons "suivant", "pr√©c√©dent", "recommencer" et "choisir un autre th√®me"
nextBtn.addEventListener('click', goToNextQuestion);
prevBtn.addEventListener('click', goToPrevQuestion);
restartQuizBtn.addEventListener('click', restartQuiz);
chooseThemeBtn.addEventListener('click', chooseAnotherTheme);

// Bouton "home" avec simple message d‚Äôalerte
homeBtn.addEventListener('click', () => {
    alert("Cette fonctionnalit√© vous ram√®nerait √† la page d'accueil");
});

// Fonction qui d√©marre le quiz selon le th√®me s√©lectionn√©
function startQuizByTheme(theme) {
    currentTheme = theme;

    if (theme === 'all') {
        quizData = [...allQuizData]; // Prend toutes les questions
        maxScore = quizData.length * 2;
    } else {
        quizData = allQuizData.filter(q => q.theme === theme); // Filtre selon le th√®me
        maxScore = quizData.length * 2;
    }

    quizData = shuffleArray(quizData); // M√©lange les questions

    userAnswers = Array(quizData.length).fill(null); // R√©initialise les r√©ponses
    currentQuestion = 0;
    score = 0;

    quizIntro.classList.add('hidden'); // Cache l‚Äôintro
    quizContainer.classList.remove('hidden'); // Affiche le quiz

    loadQuestion(); // Charge la premi√®re question
    startTimer(); // D√©marre le chronom√®tre
    quizStartTime = new Date(); // Enregistre l‚Äôheure de d√©but

    scoreTotal.textContent = `sur ${maxScore}`; // Affiche le score total possible
}

// Fonction qui charge la question actuelle
function loadQuestion() {
    const question = quizData[currentQuestion];

    questionCounter.textContent = `Question ${currentQuestion + 1}/${quizData.length}`;
    progressBar.style.width = `${((currentQuestion + 1) / quizData.length) * 100}%`;

    // D√©termine le style du badge selon la cat√©gorie
    let badgeClass = '';
    if (question.category.includes('Maladies')) {
        badgeClass = 'bg-blue-100 text-blue-800';
    } else if (question.category.includes('G√©n√©tique')) {
        badgeClass = 'bg-purple-100 text-purple-800';
    } else {
        badgeClass = 'bg-green-100 text-green-800';
    }

    categoryBadge.className = `inline-block px-3 py-1 rounded-full text-sm font-medium mb-4 ${badgeClass}`;
    categoryBadge.textContent = question.category;

    questionText.textContent = question.question; // Affiche le texte de la question

    optionsContainer.innerHTML = ''; // Vide les options pr√©c√©dentes

    // Affiche les options sous forme de boutons cliquables
    question.options.forEach((option, index) => {
        const optionElement = document.createElement('div');
        optionElement.className = `option p-4 border rounded-lg cursor-pointer hover:bg-gray-50 ${userAnswers[currentQuestion] === index ? 'selected' : ''}`;
        optionElement.innerHTML = `
            <div class="flex items-center">
                <div class="w-6 h-6 flex items-center justify-center rounded-full border border-gray-300 mr-3 ${userAnswers[currentQuestion] === index ? 'bg-indigo-600 border-indigo-600' : ''}">
                    <span class="text-xs font-bold ${userAnswers[currentQuestion] === index ? 'text-white' : 'text-transparent'}">‚úì</span>
                </div>
                <span>${String.fromCharCode(65 + index)}. ${option}</span>
            </div>
        `;
        optionElement.addEventListener('click', () => selectOption(index));
        optionsContainer.appendChild(optionElement);
    });

    // Affiche ou cache les boutons selon la position dans le quiz
    prevBtn.classList.toggle('hidden', currentQuestion === 0);
    nextBtn.textContent = currentQuestion === quizData.length - 1 ? 'Terminer' : 'Suivant ‚Üí';
    nextBtn.disabled = userAnswers[currentQuestion] === null;
}

// Fonction appel√©e lorsqu‚Äôune option est s√©lectionn√©e
function selectOption(index) {
    userAnswers[currentQuestion] = index; // Enregistre la r√©ponse

    // Met √† jour l‚Äôapparence visuelle des options
    const options = optionsContainer.querySelectorAll('.option');
    options.forEach((option, i) => {
        option.classList.toggle('selected', i === index);
        const checkmark = option.querySelector('.w-6');
        checkmark.classList.toggle('bg-indigo-600', i === index);
        checkmark.classList.toggle('border-indigo-600', i === index);
        const checkmarkText = option.querySelector('.text-xs');
        checkmarkText.classList.toggle('text-white', i === index);
        checkmarkText.classList.toggle('text-transparent', i !== index);
    });

    nextBtn.disabled = false; // Active le bouton "suivant"
}

// Passe √† la question suivante ou termine le quiz
function goToNextQuestion() {
    if (currentQuestion < quizData.length - 1) {
        currentQuestion++;
        loadQuestion();
    } else {
        finishQuiz(); // Fin du quiz
    }
}

// Revenir √† la question pr√©c√©dente
function goToPrevQuestion() {
    if (currentQuestion > 0) {
        currentQuestion--;
        loadQuestion();
    }
}

// Lance le minuteur du quiz
function startTimer() {
    let seconds = 0;
    timerInterval = setInterval(() => {
        seconds++;
        const minutes = Math.floor(seconds / 60);
        const remainingSeconds = seconds % 60;
        timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
    }, 1000);
}

// Arr√™te le minuteur
function stopTimer() {
    clearInterval(timerInterval);
}

// Formate les secondes en minutes:secondes
function formatTime(seconds) {
    const minutes = Math.floor(seconds / 60);
    const remainingSeconds = seconds % 60;
    return `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
}

// Fonction appel√©e √† la fin du quiz
function finishQuiz() {
    quizEndTime = new Date(); // Enregistre la fin
    stopTimer(); // Arr√™te le minuteur

    // Calcul du score final
    score = 0;
    userAnswers.forEach((answer, index) => {
        const question = quizData[index];
        if (question.multipleAnswers) {
            if (question.correctAnswers.includes(answer)) {
                score += 2;
            }
        } else {
            if (answer === question.correctAnswer) {
                score += 2;
            }
        }
    });

    // Affiche les r√©sultats
    quizContainer.classList.add('hidden');
    resultsContainer.classList.remove('hidden');
    scoreValue.textContent = score;

    // Affiche un message selon le pourcentage de r√©ussite
    const percentage = (score / maxScore) * 100;
    if (percentage >= 80) {
        scoreMessage.textContent = "Excellent ! Vous √™tes un expert !";
    } else if (percentage >= 60) {
        scoreMessage.textContent = "Tr√®s bien ! Vous avez de bonnes connaissances.";
    } else if (percentage >= 40) {
        scoreMessage.textContent = "Pas mal ! Continuez √† apprendre.";
    } else {
        scoreMessage.textContent = "Vous pouvez vous am√©liorer. R√©essayez !";
    }

    // Temps total pass√© sur le quiz
    const totalTimeInSeconds = Math.floor((quizEndTime - quizStartTime) / 1000);
    totalTime.textContent = formatTime(totalTimeInSeconds);

    generateThemeResults(); // R√©sultats par th√®me
    generateAnswersReview(); // R√©capitulatif des r√©ponses
}

// G√©n√®re les r√©sultats du quiz par th√®me
function generateThemeResults() {
    themeResults.innerHTML = '';

    const themeGroups = {
        diseases: { name: "Maladies Infectieuses", icon: "ü¶†", color: "blue", correct: 0, total: 0 },
        genetics: { name: "G√©n√©tique & Corps Humain", icon: "üß¨", color: "purple", correct: 0, total: 0 },
        informatics: { name: "Informatique & Bioinformatique", icon: "üë®‚Äçüíª", color: "green", correct: 0, total: 0 }
    };

    // Parcours des r√©ponses pour calculer les scores par th√®me
    userAnswers.forEach((answer, index) => {
        const question = quizData[index];
        const theme = question.theme;

        themeGroups[theme].total += 2;

        if (question.multipleAnswers) {
            if (question.correctAnswers.includes(answer)) {
                themeGroups[theme].correct += 2;
            }
        } else {
            if (answer === question.correctAnswer) {
                themeGroups[theme].correct += 2;
            }
        }
    });

    // (Suite ici dans la suite du code : Object.values(themeGroups)...)-------------------------------------------------------------------------
        

    // G√©n√®re les cartes de r√©sum√© par th√®me (score par th√®me, couleur, barre de progression)
    Object.values(themeGroups).forEach(theme => {
        if (theme.total > 0) {
            const percentage = (theme.correct / theme.total) * 100; // Calcule le pourcentage de bonnes r√©ponses

            // Cr√©e une carte visuelle pour le th√®me
            const themeCard = document.createElement('div');
            themeCard.className = `bg-${theme.color}-50 p-4 rounded-lg border border-${theme.color}-200`;

            // Contenu HTML de la carte (ic√¥ne, nom du th√®me, score, pourcentage et barre)
            themeCard.innerHTML = `
                <div class="flex items-center mb-2">
                    <span class="text-2xl mr-2">${theme.icon}</span>
                    <h4 class="font-medium text-${theme.color}-800">${theme.name}</h4>
                </div>
                <div class="flex items-center justify-between">
                    <span class="text-sm text-gray-600">${theme.correct}/${theme.total} points</span>
                    <span class="text-sm font-medium ${percentage >= 60 ? 'text-green-600' : 'text-red-600'}">${percentage}%</span>
                </div>
                <div class="mt-2 h-2 bg-gray-200 rounded-full">
                    <div class="h-full rounded-full ${percentage >= 60 ? 'bg-green-500' : 'bg-red-500'}" style="width: ${percentage}%"></div>
                </div>
            `;
            themeResults.appendChild(themeCard); // Ajoute la carte au container
        }
    });
}

// G√©n√®re la revue des r√©ponses √† la fin du quiz
function generateAnswersReview() {
    answersReview.innerHTML = ''; // Vide le container d'affichage des r√©ponses

    // Extrait les cat√©gories uniques du quiz
    const categories = [...new Set(quizData.map(q => q.category))];

    // Pour chaque cat√©gorie, affiche les questions correspondantes
    categories.forEach(category => {

        // Cr√©e un titre de section pour chaque cat√©gorie
        const categoryHeader = document.createElement('div');
        categoryHeader.className = 'mt-8 mb-4';
        categoryHeader.innerHTML = `<h3 class="text-xl font-semibold text-gray-800">${category}</h3>`;
        answersReview.appendChild(categoryHeader);

        // Filtre les questions de cette cat√©gorie
        const categoryQuestions = quizData.filter(q => q.category === category);

        // Pour chaque question, cr√©e un bloc d'affichage avec r√©ponse utilisateur, bonne r√©ponse, explication
        categoryQuestions.forEach(question => {
            const questionIndex = quizData.indexOf(question);
            const userAnswer = userAnswers[questionIndex];

            let isCorrect = false;

            // V√©rifie si la r√©ponse est correcte selon qu'il y ait une ou plusieurs r√©ponses possibles
            if (question.multipleAnswers) {
                isCorrect = question.correctAnswers.includes(userAnswer);
            } else {
                isCorrect = userAnswer === question.correctAnswer;
            }

            // Cr√©e une carte de retour sur la r√©ponse
            const reviewItem = document.createElement('div');
            reviewItem.className = `p-4 rounded-lg ${isCorrect ? 'bg-green-50 border border-green-200' : 'bg-red-50 border border-red-200'} mb-4`;

            // Contenu HTML de la carte de r√©ponse
            reviewItem.innerHTML = `
                <div class="flex items-start">
                    <span class="mr-2 mt-1 ${isCorrect ? 'text-green-500' : 'text-red-500'}">${isCorrect ? '‚úÖ' : '‚ùå'}</span>
                    <div class="flex-1">
                        <h4 class="font-medium text-gray-800">${questionIndex + 1}. ${question.question}</h4>
                        <p class="text-sm text-gray-600 mt-1">
                            <span class="font-medium">Votre r√©ponse:</span> 
                            ${String.fromCharCode(65 + userAnswer)}. ${question.options[userAnswer]}
                        </p>
                        ${!isCorrect ? `
                            <p class="text-sm text-gray-600 mt-1">
                                <span class="font-medium">R√©ponse correcte:</span> 
                                ${question.multipleAnswers ? 
                                    question.correctAnswers.map(ans => `${String.fromCharCode(65 + ans)}. ${question.options[ans]}`).join(' ou ') : 
                                    `${String.fromCharCode(65 + question.correctAnswer)}. ${question.options[question.correctAnswer]}`
                                }
                            </p>
                        ` : ''}
                        <div class="mt-2 p-2 bg-white rounded border border-gray-200">
                            <p class="text-sm flex items-start">
                                <span class="text-lg mr-1">üß†</span>
                                <span>${question.explanation}</span>
                            </p>
                        </div>
                    </div>
                </div>
            `;
            answersReview.appendChild(reviewItem); // Ajoute au container
        });
    });
}

// Relance un nouveau quiz depuis le d√©but
function restartQuiz() {
    resultsContainer.classList.add('hidden'); // Cache les r√©sultats
    quizContainer.classList.remove('hidden'); // R√©affiche le quiz

    // R√©initialise les variables
    userAnswers = Array(quizData.length).fill(null);
    currentQuestion = 0;
    score = 0;

    // Recharge la premi√®re question
    loadQuestion();

    // Red√©marre le minuteur
    startTimer();
    quizStartTime = new Date();
}

// Permet de revenir √† la s√©lection des th√®mes
function chooseAnotherTheme() {
    resultsContainer.classList.add('hidden'); // Cache les r√©sultats
    quizIntro.classList.remove('hidden');     // R√©affiche l‚Äôintro
}

// Fonction utilitaire : m√©lange al√©atoirement les √©l√©ments d‚Äôun tableau (Fisher-Yates)
function shuffleArray(array) {
    const newArray = [...array];
    for (let i = newArray.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
    }
    return newArray;
}

</script>

</body>
</html>
